<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Recreating the Rain Drop Effect in The Legend of Zelda: TOTK | Yaotian Huang</title>
<meta name="keywords" content="Unity, C#, Compute Shader, Render Feature, Post Processing, URP">
<meta name="description" content="Environment Unity 2021.3.16f1
Universal Render Pipeline 12.0.0
Introduction I recently finished The Legend of Zelda: Tears of the Kingdom. To me as an indie game developer, it felt like a text book of open world game design. I had a lot of fun playing it and I learned a lot from it.
One of the things I noticed is the rain drop effect that react to the uppper edges of the scene.">
<meta name="author" content="sky_haihai">
<link rel="canonical" href="https://sky-haihai.github.io/Yaotian-Huang/posts/gamedev/recreating-the-rain-drop-effect-in-the-legend-of-zelda-totk/">
<link crossorigin="anonymous" href="/Yaotian-Huang/assets/css/stylesheet.62aa25427797f8efd87301a5b69795dc50df2dbe79a5fba0648cc7bb8dbcd7c9.css" integrity="sha256-YqolQneX&#43;O/YcwGltpeV3FDfLb55pfugZIzHu42818k=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/Yaotian-Huang/assets/js/highlight.acb54fd32bbc1982428b8850317e45d076b95012730a5936667e6bc21777692a.js" integrity="sha256-rLVP0yu8GYJCi4hQMX5F0Ha5UBJzClk2Zn5rwhd3aSo="
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://sky-haihai.github.io/Yaotian-Huang/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://sky-haihai.github.io/Yaotian-Huang/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://sky-haihai.github.io/Yaotian-Huang/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://sky-haihai.github.io/Yaotian-Huang/apple-touch-icon.png">
<link rel="mask-icon" href="https://sky-haihai.github.io/Yaotian-Huang/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:title" content="Recreating the Rain Drop Effect in The Legend of Zelda: TOTK" />
<meta property="og:description" content="Environment Unity 2021.3.16f1
Universal Render Pipeline 12.0.0
Introduction I recently finished The Legend of Zelda: Tears of the Kingdom. To me as an indie game developer, it felt like a text book of open world game design. I had a lot of fun playing it and I learned a lot from it.
One of the things I noticed is the rain drop effect that react to the uppper edges of the scene." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://sky-haihai.github.io/Yaotian-Huang/posts/gamedev/recreating-the-rain-drop-effect-in-the-legend-of-zelda-totk/" /><meta property="og:image" content="https://sky-haihai.github.io/Yaotian-Huang/papermod-cover.png"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-05-23T23:50:10-04:00" />
<meta property="article:modified_time" content="2023-05-23T23:50:10-04:00" />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://sky-haihai.github.io/Yaotian-Huang/papermod-cover.png"/>

<meta name="twitter:title" content="Recreating the Rain Drop Effect in The Legend of Zelda: TOTK"/>
<meta name="twitter:description" content="Environment Unity 2021.3.16f1
Universal Render Pipeline 12.0.0
Introduction I recently finished The Legend of Zelda: Tears of the Kingdom. To me as an indie game developer, it felt like a text book of open world game design. I had a lot of fun playing it and I learned a lot from it.
One of the things I noticed is the rain drop effect that react to the uppper edges of the scene."/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://sky-haihai.github.io/Yaotian-Huang/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Recreating the Rain Drop Effect in The Legend of Zelda: TOTK",
      "item": "https://sky-haihai.github.io/Yaotian-Huang/posts/gamedev/recreating-the-rain-drop-effect-in-the-legend-of-zelda-totk/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Recreating the Rain Drop Effect in The Legend of Zelda: TOTK",
  "name": "Recreating the Rain Drop Effect in The Legend of Zelda: TOTK",
  "description": "Environment Unity 2021.3.16f1\nUniversal Render Pipeline 12.0.0\nIntroduction I recently finished The Legend of Zelda: Tears of the Kingdom. To me as an indie game developer, it felt like a text book of open world game design. I had a lot of fun playing it and I learned a lot from it.\nOne of the things I noticed is the rain drop effect that react to the uppper edges of the scene.",
  "keywords": [
    "Unity", "C#", "Compute Shader", "Render Feature", "Post Processing", "URP"
  ],
  "articleBody": "Environment Unity 2021.3.16f1\nUniversal Render Pipeline 12.0.0\nIntroduction I recently finished The Legend of Zelda: Tears of the Kingdom. To me as an indie game developer, it felt like a text book of open world game design. I had a lot of fun playing it and I learned a lot from it.\nOne of the things I noticed is the rain drop effect that react to the uppper edges of the scene. It’s a very subtle effect but it actually guided me through the thunder island where the player’s visibility range was less than 1 meter. In the image below, you can see that the rain drops react to the edge of the mining cart rails, which tells the player that there is a path to continue the journey. I guess probably the game designer didn’t intend to do this, but it’s Nintendo, you never know.\nThis effect was one of the a few things I could rely on while exploring the island, so I decided to implement it in Unity as a render feature, just to show my appreciation to those little rain drops.\nDemo How It Works The effect basically composes of two parts: Edge detection with angle limitation and a fast scrolling noise map.\nEdge Detection From the image above, we can see that the effect is applied even in places that have no gradient such as the rails. Therefore, it has to be using the depth buffer. With that being clear, We just need to apply a sobel edge deteciton on the depth buffer and get a edge mask.\nIf you are not familar with Sobel Edge Detection. Here is a quick explanation. Sobel Edge Detection is a simple edge detection algorithm that uses two 3x3 kernels to calculate the gradient of the image.\nHorizontal:\n-1 0 1\r-2 0 2\r-1 0 1 Vertical:\n1 2 1\r0 0 0\r-1 -2 -1 Apply the two kernels respectively on each pixel(x,y) in the depth texture(depth):\nhorizontal = depth[x-1,y-1] * -1 + depth[x,y-1] * 0 + depth[x+1,y-1] * 1\r+ depth[x-1,y] * -2 + depth[x,y] * 0 + depth[x+1,y] * 2\r+ depth[x-1,y+1] * -1 + depth[x,y+1] * 0 + depth[x+1,y+1] * 1\rvertical = depth[x-1,y-1] * -1 + depth[x,y-1] * -2 + depth[x+1,y-1] * -1\r+ depth[x-1,y] * 0 + depth[x,y] * 0 + depth[x+1,y] * 0\r+ depth[x-1,y+1] * 1 + depth[x,y+1] * 2 + depth[x+1,y+1] * 1 Then we can calculate the magnitude of the gradient by taking the square root of the sum of the squares of the two gradients:\nmagnitude = sqrt(horizontal * horizontal + vertical * vertical) The magnitude is the value we are looking for. It describes the color gradient between the pixel and its neighbors. The higher the value, the more likely it is an edge.\nFrom here, we do need one more value to describe the “direction” of the gradient. If it doesn’t make sense to you. Just think about the gradient as a vector, composed of the horizontal gradient value we calculated before and the vertical gradient value. We can calculate the angle between the gradient vector and the horizontal axis by taking the arctangent of the vertical gradient over the horizontal gradient.\nangle = atan2(vertical, horizontal) It gives us a value between -pi and pi, representing the angle of the vector in radian.\nNow we have the magnitude and the angle of the gradient. We can use them to create a mask that only shows the edges we want, which are the edges that are facing up.\nNoise Map Congradulations to you and future me that forgot how I did this! for making it this far. Now we have the edge mask, we can just multiply a scrolling noise map on it to get the final mask.\nAfter that, configure the settings as you like: thickness, sobel threshold, rain drop scale, drop speed, drop color, etc.\nFor noise map, I used a simple 2D perlin noise map that I generated from this website: http://kitfox.com/projects/perlinNoiseMaker/\nImplementation Strcutre a Render Feature First thing is first, we need to figure out what are the main inputs of the compute shader.\nA noise texture. A thickness float value to control the “thickness” of the rain drops edges. A sobel threshold float value to control the threshold of the sobel edge detection. A rain drop scale float value to control the threshold of the step function that applies on the noise map to essentially control the size/density of the rain drops. Other than these input values, we also need some parameters for the render feature to work.\nA compute shader to do the contain all the calculations. A RenderPassEvent to tell the render feature when to execute the render pass. And to make it more debuggable:\nA UV scrolling speed float value to control the speed of the scrolling noise map A switch boolean value to turn on/off the rain drop effect in Unity Scene Editor. Finally construct them into a Setting class inside a ScriptalbeRendererFeature. As always, you can name this class whatever you want. I named it ZeldaRainDropFeature.\nusing UnityEngine; using UnityEngine.Rendering; using UnityEngine.Rendering.Universal; using UnityEngine.Serialization; public class ZeldaRainDropFeature : ScriptableRendererFeature { [SerializeField] public Settings settings = new Settings(); public override void Create() { m_RenderPass = new RainDropRenderPass(settings) { renderPassEvent = settings.renderPassEvent }; } public override void AddRenderPasses(ScriptableRenderer renderer, ref RenderingData renderingData) { if (settings.rainDropShader != null \u0026\u0026 settings.rainDropShader != null) { renderer.EnqueuePass(m_RenderPass); } } [System.Serializable] public class Settings { public ComputeShader rainDropShader; public Texture2D noiseTex; public Color dropColor = Color.white; [Range(0, 20)] public int thickness = 3; [Range(0f, 1f)] public float sobelThreshold = 0.166f; [Range(0f, 1f)] public float rainDropScale = 0.5f; public float dropSpeed = 100f; public RenderPassEvent renderPassEvent = RenderPassEvent.AfterRenderingTransparents; public bool previewInSceneView = true; } } Create a Render Pass Now we have the settings and a basic structure of the render feature. We can start to implement the render pass.\nprivate class RainDropRenderPass : ScriptableRenderPass { private Settings m_Settings; private RenderTargetHandle m_ResultTex; //camera color public RainDropRenderPass(Settings settings) { m_Settings = settings; } public override void Configure(CommandBuffer cmd, RenderTextureDescriptor cameraTextureDescriptor) { var descriptor = cameraTextureDescriptor; descriptor.colorFormat = RenderTextureFormat.ARGB32; descriptor.enableRandomWrite = true; cmd.GetTemporaryRT(m_ResultTex.id, descriptor); } public override void Execute(ScriptableRenderContext context, ref RenderingData renderingData) { if (!m_Settings.previewInSceneView \u0026\u0026 (renderingData.cameraData.isSceneViewCamera || renderingData.cameraData.isPreviewCamera)) { return; } CommandBuffer cmd = CommandBufferPool.Get(name: \"Screen Door Transparency\"); cmd.Clear(); //cache color target var cam = renderingData.cameraData.renderer; var shader = m_Settings.rainDropShader; var mainKernel = shader.FindKernel(\"ScreenSpaceRainDrop\"); //sobel cmd.SetComputeTextureParam(shader, mainKernel, \"_InputColorTex\", cam.cameraColorTarget); cmd.SetComputeTextureParam(shader, mainKernel, \"_InputDepthTex\", cam.cameraDepthTarget); cmd.SetComputeTextureParam(shader, mainKernel, \"_NoiseTex\", m_Settings.noiseTex); cmd.SetComputeIntParam(shader, \"_Thickness\", m_Settings.thickness); cmd.SetComputeFloatParam(shader, \"_EdgeThreshold\", m_Settings.sobelThreshold); //noise cmd.SetComputeFloatParam(shader, \"_RainDropScale\", m_Settings.rainDropScale); cmd.SetComputeIntParam(shader, \"_NoiseWidth\", m_Settings.noiseTex.width); cmd.SetComputeIntParam(shader, \"_NoiseHeight\", m_Settings.noiseTex.height); cmd.SetComputeVectorParam(shader, \"_Time\", Shader.GetGlobalVector(\"_Time\")); cmd.SetComputeFloatParam(shader, \"_DropSpeed\", m_Settings.dropSpeed); cmd.SetComputeVectorParam(shader, \"_DropColor\", m_Settings.dropColor); //output cmd.SetComputeTextureParam(shader, mainKernel, \"_OutputTex\", m_ResultTex.Identifier()); cmd.SetComputeIntParam(shader, \"_Width\", renderingData.cameraData.camera.scaledPixelWidth); cmd.SetComputeIntParam(shader, \"_Height\", renderingData.cameraData.camera.scaledPixelHeight); int threadGroupX = Mathf.CeilToInt(renderingData.cameraData.camera.scaledPixelWidth / 8.0f); int threadGroupY = Mathf.CeilToInt(renderingData.cameraData.camera.scaledPixelHeight / 8.0f); cmd.DispatchCompute(shader, mainKernel, threadGroupX, threadGroupY, 1); cmd.Blit(m_ResultTex.id, cam.cameraColorTarget); context.ExecuteCommandBuffer(cmd); CommandBufferPool.Release(cmd); context.Submit(); } public override void FrameCleanup(CommandBuffer cmd) { cmd.ReleaseTemporaryRT(m_ResultTex.id); } } Final Code Git Repo\nImprovement There are a few things I can improve in the future:\nChange the effect to Layer-based or Object-based for some very specific effects. But it will cost more performance and Tears of the kindom didn’t do that, so I guess it’s not necessary. Play with the noise map to get a better looking rain drop. For example, downscale the noise map to get more blurred rain drops and save performance. ",
  "wordCount" : "1226",
  "inLanguage": "en",
  "datePublished": "2023-05-23T23:50:10-04:00",
  "dateModified": "2023-05-23T23:50:10-04:00",
  "author":{
    "@type": "Person",
    "name": "sky_haihai"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://sky-haihai.github.io/Yaotian-Huang/posts/gamedev/recreating-the-rain-drop-effect-in-the-legend-of-zelda-totk/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Yaotian Huang",
    "logo": {
      "@type": "ImageObject",
      "url": "https://sky-haihai.github.io/Yaotian-Huang/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://sky-haihai.github.io/Yaotian-Huang/" accesskey="h" title="Yaotian Huang (Alt + H)">Yaotian Huang</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://sky-haihai.github.io/Yaotian-Huang/archives" title="Archive">
                    <span>Archive</span>
                </a>
            </li>
            <li>
                <a href="https://sky-haihai.github.io/Yaotian-Huang/search/" title="Search (Alt &#43; /)" accesskey=/>
                    <span>Search</span>
                </a>
            </li>
            <li>
                <a href="https://sky-haihai.github.io/Yaotian-Huang/tags/" title="Tags">
                    <span>Tags</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://sky-haihai.github.io/Yaotian-Huang/">Home</a>&nbsp;»&nbsp;<a href="https://sky-haihai.github.io/Yaotian-Huang/posts/">Posts</a></div>
    <h1 class="post-title">
      Recreating the Rain Drop Effect in The Legend of Zelda: TOTK
    </h1>
    <div class="post-meta"><span title='2023-05-23 23:50:10 -0400 -0400'>May 23, 2023</span>&nbsp;·&nbsp;6 min&nbsp;·&nbsp;sky_haihai

</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#environment" aria-label="Environment">Environment</a></li>
                <li>
                    <a href="#introduction" aria-label="Introduction">Introduction</a></li>
                <li>
                    <a href="#demo" aria-label="Demo">Demo</a></li>
                <li>
                    <a href="#how-it-works" aria-label="How It Works">How It Works</a><ul>
                        
                <li>
                    <a href="#edge-detection" aria-label="Edge Detection">Edge Detection</a></li>
                <li>
                    <a href="#noise-map" aria-label="Noise Map">Noise Map</a></li></ul>
                </li>
                <li>
                    <a href="#implementation" aria-label="Implementation">Implementation</a><ul>
                        
                <li>
                    <a href="#strcutre-a-render-feature" aria-label="Strcutre a Render Feature">Strcutre a Render Feature</a></li>
                <li>
                    <a href="#create-a-render-pass" aria-label="Create a Render Pass">Create a Render Pass</a></li>
                <li>
                    <a href="#final-code" aria-label="Final Code">Final Code</a></li></ul>
                </li>
                <li>
                    <a href="#improvement" aria-label="Improvement">Improvement</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h2 id="environment">Environment<a hidden class="anchor" aria-hidden="true" href="#environment">#</a></h2>
<p>Unity 2021.3.16f1<br>
Universal Render Pipeline 12.0.0</p>
<h2 id="introduction">Introduction<a hidden class="anchor" aria-hidden="true" href="#introduction">#</a></h2>
<p>I recently finished <em>The Legend of Zelda: Tears of the Kingdom</em>. To me as an indie game developer, it felt like a text book of open world game design. I had a lot of fun playing it and I learned a lot from it.</p>
<p>One of the things I noticed is the rain drop effect that react to the uppper edges of the scene. It&rsquo;s a very subtle effect but it actually guided me through the thunder island where the player&rsquo;s visibility range was less than 1 meter. In the image below, you can see that the rain drops react to the edge of the mining cart rails, which tells the player that there is a path to continue the journey. I guess probably the game designer didn&rsquo;t intend to do this, but it&rsquo;s Nintendo, you never know.</p>
<figure>
    <img loading="lazy" src="life-saver.png"/> 
</figure>

<p>This effect was one of the a few things I could rely on while exploring the island, so I decided to implement it in Unity as a render feature, just to show my appreciation to those little rain drops.</p>
<h2 id="demo">Demo<a hidden class="anchor" aria-hidden="true" href="#demo">#</a></h2>

<div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;">
  <iframe src="https://www.youtube.com/embed/1oAGbDdVZ7E" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0;" allowfullscreen title="YouTube Video"></iframe>
</div>

<h2 id="how-it-works">How It Works<a hidden class="anchor" aria-hidden="true" href="#how-it-works">#</a></h2>
<p>The effect basically composes of two parts: Edge detection with angle limitation and a fast scrolling noise map.</p>
<h3 id="edge-detection">Edge Detection<a hidden class="anchor" aria-hidden="true" href="#edge-detection">#</a></h3>
<p>From the image above, we can see that the effect is applied even in places that have no gradient such as the rails. Therefore, it has to be using the depth buffer. With that being clear, We just need to apply a sobel edge deteciton on the depth buffer and get a edge mask.</p>
<p>If you are not familar with Sobel Edge Detection. Here is a quick explanation. Sobel Edge Detection is a simple edge detection algorithm that uses two 3x3 kernels to calculate the gradient of the image.</p>
<p>Horizontal:</p>
<pre tabindex="0"><code>-1  0  1
-2  0  2
-1  0  1
</code></pre><p>Vertical:</p>
<pre tabindex="0"><code> 1  2  1
 0  0  0
-1 -2 -1
</code></pre><p>Apply the two kernels respectively on each pixel(x,y) in the depth texture(depth):</p>
<pre tabindex="0"><code>horizontal = depth[x-1,y-1] * -1 + depth[x,y-1] * 0 + depth[x+1,y-1] * 1
           + depth[x-1,y]   * -2 + depth[x,y]   * 0 + depth[x+1,y]   * 2
           + depth[x-1,y+1] * -1 + depth[x,y+1] * 0 + depth[x+1,y+1] * 1

vertical = depth[x-1,y-1] * -1 + depth[x,y-1] * -2 + depth[x+1,y-1] * -1
         + depth[x-1,y]   * 0 + depth[x,y]   * 0 + depth[x+1,y]   * 0
         + depth[x-1,y+1] * 1 + depth[x,y+1] * 2 + depth[x+1,y+1] * 1
</code></pre><p>Then we can calculate the magnitude of the gradient by taking the square root of the sum of the squares of the two gradients:</p>
<pre tabindex="0"><code>magnitude = sqrt(horizontal * horizontal + vertical * vertical)
</code></pre><p>The magnitude is the value we are looking for. It describes the color gradient between the pixel and its neighbors. The higher the value, the more likely it is an edge.</p>
<p>From here, we do need one more value to describe the &ldquo;direction&rdquo; of the gradient. If it doesn&rsquo;t make sense to you. Just think about the gradient as a vector, composed of the horizontal gradient value we calculated before and the vertical gradient value. We can calculate the angle between the gradient vector and the horizontal axis by taking the arctangent of the vertical gradient over the horizontal gradient.</p>
<pre tabindex="0"><code>angle = atan2(vertical, horizontal)
</code></pre><p>It gives us a value between -pi and pi, representing the angle of the vector in radian.</p>
<p>Now we have the magnitude and the angle of the gradient. We can use them to create a mask that only shows the edges we want, which are the edges that are facing up.</p>
<figure>
    <img loading="lazy" src="demo_mask.png"/> 
</figure>

<h3 id="noise-map">Noise Map<a hidden class="anchor" aria-hidden="true" href="#noise-map">#</a></h3>
<p>Congradulations to you and future me that forgot how I did this! for making it this far. Now we have the edge mask, we can just multiply a scrolling noise map on it to get the final mask.</p>
<p>After that, configure the settings as you like: thickness, sobel threshold, rain drop scale, drop speed, drop color, etc.</p>
<p>For noise map, I used a simple 2D perlin noise map that I generated from this website: <a href="http://kitfox.com/projects/perlinNoiseMaker/">http://kitfox.com/projects/perlinNoiseMaker/</a></p>
<figure>
    <img loading="lazy" src="noise_map.png"/> 
</figure>

<h2 id="implementation">Implementation<a hidden class="anchor" aria-hidden="true" href="#implementation">#</a></h2>
<h3 id="strcutre-a-render-feature">Strcutre a Render Feature<a hidden class="anchor" aria-hidden="true" href="#strcutre-a-render-feature">#</a></h3>
<p>First thing is first, we need to figure out what are the main inputs of the compute shader.</p>
<ul>
<li>A noise texture.</li>
<li>A thickness float value to control the &ldquo;thickness&rdquo; of the rain drops edges.</li>
<li>A sobel threshold float value to control the threshold of the sobel edge detection.</li>
<li>A rain drop scale float value to control the threshold of the step function that applies on the noise map to essentially control the size/density of the rain drops.</li>
</ul>
<p>Other than these input values, we also need some parameters for the render feature to work.</p>
<ul>
<li>A compute shader to do the contain all the calculations.</li>
<li>A RenderPassEvent to tell the render feature when to execute the render pass.</li>
</ul>
<p>And to make it more debuggable:</p>
<ul>
<li>A UV scrolling speed float value to control the speed of the scrolling noise map</li>
<li>A switch boolean value to turn on/off the rain drop effect in Unity Scene Editor.</li>
</ul>
<p>Finally construct them into a Setting class inside a ScriptalbeRendererFeature. As always, you can name this class whatever you want. I named it ZeldaRainDropFeature.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">using</span> UnityEngine;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">using</span> UnityEngine.Rendering;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">using</span> UnityEngine.Rendering.Universal;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">using</span> UnityEngine.Serialization;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ZeldaRainDropFeature</span> : ScriptableRendererFeature {
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">    [SerializeField]</span> <span style="color:#66d9ef">public</span> Settings settings = <span style="color:#66d9ef">new</span> Settings();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">void</span> Create() {
</span></span><span style="display:flex;"><span>        m_RenderPass = <span style="color:#66d9ef">new</span> RainDropRenderPass(settings) {
</span></span><span style="display:flex;"><span>            renderPassEvent = settings.renderPassEvent
</span></span><span style="display:flex;"><span>        };
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">void</span> AddRenderPasses(ScriptableRenderer renderer, <span style="color:#66d9ef">ref</span> RenderingData renderingData) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (settings.rainDropShader != <span style="color:#66d9ef">null</span> &amp;&amp; settings.rainDropShader != <span style="color:#66d9ef">null</span>) {
</span></span><span style="display:flex;"><span>            renderer.EnqueuePass(m_RenderPass);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">
</span></span></span><span style="display:flex;"><span><span style="color:#a6e22e">    [System.Serializable]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Settings</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">public</span> ComputeShader rainDropShader;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">public</span> Texture2D noiseTex;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">public</span> Color dropColor = Color.white;
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">        [Range(0, 20)]</span> <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">int</span> thickness = <span style="color:#ae81ff">3</span>;
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">        [Range(0f, 1f)]</span> <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">float</span> sobelThreshold = <span style="color:#ae81ff">0.166f</span>;
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">        [Range(0f, 1f)]</span> <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">float</span> rainDropScale = <span style="color:#ae81ff">0.5f</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">float</span> dropSpeed = <span style="color:#ae81ff">100f</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">public</span> RenderPassEvent renderPassEvent = RenderPassEvent.AfterRenderingTransparents;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">bool</span> previewInSceneView = <span style="color:#66d9ef">true</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="create-a-render-pass">Create a Render Pass<a hidden class="anchor" aria-hidden="true" href="#create-a-render-pass">#</a></h3>
<p>Now we have the settings and a basic structure of the render feature. We can start to implement the render pass.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">private</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">RainDropRenderPass</span> : ScriptableRenderPass {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">private</span> Settings m_Settings;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">private</span> RenderTargetHandle m_ResultTex; <span style="color:#75715e">//camera color</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">public</span> RainDropRenderPass(Settings settings) {
</span></span><span style="display:flex;"><span>            m_Settings = settings;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">void</span> Configure(CommandBuffer cmd, RenderTextureDescriptor cameraTextureDescriptor) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">var</span> descriptor = cameraTextureDescriptor;
</span></span><span style="display:flex;"><span>            descriptor.colorFormat = RenderTextureFormat.ARGB32;
</span></span><span style="display:flex;"><span>            descriptor.enableRandomWrite = <span style="color:#66d9ef">true</span>;
</span></span><span style="display:flex;"><span>            cmd.GetTemporaryRT(m_ResultTex.id, descriptor);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">void</span> Execute(ScriptableRenderContext context, <span style="color:#66d9ef">ref</span> RenderingData renderingData) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (!m_Settings.previewInSceneView &amp;&amp; (renderingData.cameraData.isSceneViewCamera || renderingData.cameraData.isPreviewCamera)) {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span>;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            CommandBuffer cmd = CommandBufferPool.Get(name: <span style="color:#e6db74">&#34;Screen Door Transparency&#34;</span>);
</span></span><span style="display:flex;"><span>            cmd.Clear();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">//cache color target</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">var</span> cam = renderingData.cameraData.renderer;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">var</span> shader = m_Settings.rainDropShader;
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">var</span> mainKernel = shader.FindKernel(<span style="color:#e6db74">&#34;ScreenSpaceRainDrop&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">//sobel</span>
</span></span><span style="display:flex;"><span>            cmd.SetComputeTextureParam(shader, mainKernel, <span style="color:#e6db74">&#34;_InputColorTex&#34;</span>, cam.cameraColorTarget);
</span></span><span style="display:flex;"><span>            cmd.SetComputeTextureParam(shader, mainKernel, <span style="color:#e6db74">&#34;_InputDepthTex&#34;</span>, cam.cameraDepthTarget);
</span></span><span style="display:flex;"><span>            cmd.SetComputeTextureParam(shader, mainKernel, <span style="color:#e6db74">&#34;_NoiseTex&#34;</span>, m_Settings.noiseTex);
</span></span><span style="display:flex;"><span>            cmd.SetComputeIntParam(shader, <span style="color:#e6db74">&#34;_Thickness&#34;</span>, m_Settings.thickness);
</span></span><span style="display:flex;"><span>            cmd.SetComputeFloatParam(shader, <span style="color:#e6db74">&#34;_EdgeThreshold&#34;</span>, m_Settings.sobelThreshold);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">//noise</span>
</span></span><span style="display:flex;"><span>            cmd.SetComputeFloatParam(shader, <span style="color:#e6db74">&#34;_RainDropScale&#34;</span>, m_Settings.rainDropScale);
</span></span><span style="display:flex;"><span>            cmd.SetComputeIntParam(shader, <span style="color:#e6db74">&#34;_NoiseWidth&#34;</span>, m_Settings.noiseTex.width);
</span></span><span style="display:flex;"><span>            cmd.SetComputeIntParam(shader, <span style="color:#e6db74">&#34;_NoiseHeight&#34;</span>, m_Settings.noiseTex.height);
</span></span><span style="display:flex;"><span>            cmd.SetComputeVectorParam(shader, <span style="color:#e6db74">&#34;_Time&#34;</span>, Shader.GetGlobalVector(<span style="color:#e6db74">&#34;_Time&#34;</span>));
</span></span><span style="display:flex;"><span>            cmd.SetComputeFloatParam(shader, <span style="color:#e6db74">&#34;_DropSpeed&#34;</span>, m_Settings.dropSpeed);
</span></span><span style="display:flex;"><span>            cmd.SetComputeVectorParam(shader, <span style="color:#e6db74">&#34;_DropColor&#34;</span>, m_Settings.dropColor);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">//output</span>
</span></span><span style="display:flex;"><span>            cmd.SetComputeTextureParam(shader, mainKernel, <span style="color:#e6db74">&#34;_OutputTex&#34;</span>, m_ResultTex.Identifier());
</span></span><span style="display:flex;"><span>            cmd.SetComputeIntParam(shader, <span style="color:#e6db74">&#34;_Width&#34;</span>, renderingData.cameraData.camera.scaledPixelWidth);
</span></span><span style="display:flex;"><span>            cmd.SetComputeIntParam(shader, <span style="color:#e6db74">&#34;_Height&#34;</span>, renderingData.cameraData.camera.scaledPixelHeight);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">int</span> threadGroupX = Mathf.CeilToInt(renderingData.cameraData.camera.scaledPixelWidth / <span style="color:#ae81ff">8.0f</span>);
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">int</span> threadGroupY = Mathf.CeilToInt(renderingData.cameraData.camera.scaledPixelHeight / <span style="color:#ae81ff">8.0f</span>);
</span></span><span style="display:flex;"><span>            cmd.DispatchCompute(shader, mainKernel, threadGroupX, threadGroupY, <span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            cmd.Blit(m_ResultTex.id, cam.cameraColorTarget);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            context.ExecuteCommandBuffer(cmd);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            CommandBufferPool.Release(cmd);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            context.Submit();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">void</span> FrameCleanup(CommandBuffer cmd) {
</span></span><span style="display:flex;"><span>            cmd.ReleaseTemporaryRT(m_ResultTex.id);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><h3 id="final-code">Final Code<a hidden class="anchor" aria-hidden="true" href="#final-code">#</a></h3>
<p><a href="https://github.com/sky-haihai/XihePostProcessing/tree/master/ZeldaRainDrop">Git Repo</a></p>
<h2 id="improvement">Improvement<a hidden class="anchor" aria-hidden="true" href="#improvement">#</a></h2>
<p>There are a few things I can improve in the future:</p>
<ol>
<li>Change the effect to Layer-based or Object-based for some very specific effects. But it will cost more performance and Tears of the kindom didn&rsquo;t do that, so I guess it&rsquo;s not necessary.</li>
<li>Play with the noise map to get a better looking rain drop. For example, downscale the noise map to get more blurred rain drops and save performance.</li>
</ol>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://sky-haihai.github.io/Yaotian-Huang/tags/unity/">Unity</a></li>
      <li><a href="https://sky-haihai.github.io/Yaotian-Huang/tags/c#/">C#</a></li>
      <li><a href="https://sky-haihai.github.io/Yaotian-Huang/tags/compute-shader/">Compute Shader</a></li>
      <li><a href="https://sky-haihai.github.io/Yaotian-Huang/tags/render-feature/">Render Feature</a></li>
      <li><a href="https://sky-haihai.github.io/Yaotian-Huang/tags/post-processing/">Post Processing</a></li>
      <li><a href="https://sky-haihai.github.io/Yaotian-Huang/tags/urp/">URP</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="https://sky-haihai.github.io/Yaotian-Huang/posts/gamedev/harmony-script-adding-placeholder-drawings-to-empty-timeline-cells/">
    <span class="title">« Prev</span>
    <br>
    <span>Harmony Script: Adding Placeholder Drawings to Empty Timeline Cells</span>
  </a>
  <a class="next" href="https://sky-haihai.github.io/Yaotian-Huang/posts/gamedev/layer-based-screen-door-transparency-effect-using-unity-urp-12/">
    <span class="title">Next »</span>
    <br>
    <span>Layer-based Screen-Door Transparency Effect using Unity URP 12</span>
  </a>
</nav>


<div class="share-buttons">
    <a target="_blank" rel="noopener noreferrer" aria-label="share Recreating the Rain Drop Effect in The Legend of Zelda: TOTK on twitter"
        href="https://twitter.com/intent/tweet/?text=Recreating%20the%20Rain%20Drop%20Effect%20in%20The%20Legend%20of%20Zelda%3a%20TOTK&amp;url=https%3a%2f%2fsky-haihai.github.io%2fYaotian-Huang%2fposts%2fgamedev%2frecreating-the-rain-drop-effect-in-the-legend-of-zelda-totk%2f&amp;hashtags=Unity%2cC%23%2cComputeShader%2cRenderFeature%2cPostProcessing%2cURP">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-253.927,424.544c135.939,0 210.268,-112.643 210.268,-210.268c0,-3.218 0,-6.437 -0.153,-9.502c14.406,-10.421 26.973,-23.448 36.935,-38.314c-13.18,5.824 -27.433,9.809 -42.452,11.648c15.326,-9.196 26.973,-23.602 32.49,-40.92c-14.252,8.429 -30.038,14.56 -46.896,17.931c-13.487,-14.406 -32.644,-23.295 -53.946,-23.295c-40.767,0 -73.87,33.104 -73.87,73.87c0,5.824 0.613,11.494 1.992,16.858c-61.456,-3.065 -115.862,-32.49 -152.337,-77.241c-6.284,10.881 -9.962,23.601 -9.962,37.088c0,25.594 13.027,48.276 32.95,61.456c-12.107,-0.307 -23.448,-3.678 -33.41,-9.196l0,0.92c0,35.862 25.441,65.594 59.311,72.49c-6.13,1.686 -12.72,2.606 -19.464,2.606c-4.751,0 -9.348,-0.46 -13.946,-1.38c9.349,29.426 36.628,50.728 68.965,51.341c-25.287,19.771 -57.164,31.571 -91.8,31.571c-5.977,0 -11.801,-0.306 -17.625,-1.073c32.337,21.15 71.264,33.41 112.95,33.41Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Recreating the Rain Drop Effect in The Legend of Zelda: TOTK on linkedin"
        href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fsky-haihai.github.io%2fYaotian-Huang%2fposts%2fgamedev%2frecreating-the-rain-drop-effect-in-the-legend-of-zelda-totk%2f&amp;title=Recreating%20the%20Rain%20Drop%20Effect%20in%20The%20Legend%20of%20Zelda%3a%20TOTK&amp;summary=Recreating%20the%20Rain%20Drop%20Effect%20in%20The%20Legend%20of%20Zelda%3a%20TOTK&amp;source=https%3a%2f%2fsky-haihai.github.io%2fYaotian-Huang%2fposts%2fgamedev%2frecreating-the-rain-drop-effect-in-the-legend-of-zelda-totk%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Recreating the Rain Drop Effect in The Legend of Zelda: TOTK on reddit"
        href="https://reddit.com/submit?url=https%3a%2f%2fsky-haihai.github.io%2fYaotian-Huang%2fposts%2fgamedev%2frecreating-the-rain-drop-effect-in-the-legend-of-zelda-totk%2f&title=Recreating%20the%20Rain%20Drop%20Effect%20in%20The%20Legend%20of%20Zelda%3a%20TOTK">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-3.446,265.638c0,-22.964 -18.616,-41.58 -41.58,-41.58c-11.211,0 -21.361,4.457 -28.841,11.666c-28.424,-20.508 -67.586,-33.757 -111.204,-35.278l18.941,-89.121l61.884,13.157c0.756,15.734 13.642,28.29 29.56,28.29c16.407,0 29.706,-13.299 29.706,-29.701c0,-16.403 -13.299,-29.702 -29.706,-29.702c-11.666,0 -21.657,6.792 -26.515,16.578l-69.105,-14.69c-1.922,-0.418 -3.939,-0.042 -5.585,1.036c-1.658,1.073 -2.811,2.761 -3.224,4.686l-21.152,99.438c-44.258,1.228 -84.046,14.494 -112.837,35.232c-7.468,-7.164 -17.589,-11.591 -28.757,-11.591c-22.965,0 -41.585,18.616 -41.585,41.58c0,16.896 10.095,31.41 24.568,37.918c-0.639,4.135 -0.99,8.328 -0.99,12.576c0,63.977 74.469,115.836 166.33,115.836c91.861,0 166.334,-51.859 166.334,-115.836c0,-4.218 -0.347,-8.387 -0.977,-12.493c14.564,-6.47 24.735,-21.034 24.735,-38.001Zm-119.474,108.193c-20.27,20.241 -59.115,21.816 -70.534,21.816c-11.428,0 -50.277,-1.575 -70.522,-21.82c-3.007,-3.008 -3.007,-7.882 0,-10.889c3.003,-2.999 7.882,-3.003 10.885,0c12.777,12.781 40.11,17.317 59.637,17.317c19.522,0 46.86,-4.536 59.657,-17.321c3.016,-2.999 7.886,-2.995 10.885,0.008c3.008,3.011 3.003,7.882 -0.008,10.889Zm-5.23,-48.781c-16.373,0 -29.701,-13.324 -29.701,-29.698c0,-16.381 13.328,-29.714 29.701,-29.714c16.378,0 29.706,13.333 29.706,29.714c0,16.374 -13.328,29.698 -29.706,29.698Zm-160.386,-29.702c0,-16.381 13.328,-29.71 29.714,-29.71c16.369,0 29.689,13.329 29.689,29.71c0,16.373 -13.32,29.693 -29.689,29.693c-16.386,0 -29.714,-13.32 -29.714,-29.693Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Recreating the Rain Drop Effect in The Legend of Zelda: TOTK on facebook"
        href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fsky-haihai.github.io%2fYaotian-Huang%2fposts%2fgamedev%2frecreating-the-rain-drop-effect-in-the-legend-of-zelda-totk%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-106.468,0l0,-192.915l66.6,0l12.672,-82.621l-79.272,0l0,-53.617c0,-22.603 11.073,-44.636 46.58,-44.636l36.042,0l0,-70.34c0,0 -32.71,-5.582 -63.982,-5.582c-65.288,0 -107.96,39.569 -107.96,111.204l0,62.971l-72.573,0l0,82.621l72.573,0l0,192.915l-191.104,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Recreating the Rain Drop Effect in The Legend of Zelda: TOTK on whatsapp"
        href="https://api.whatsapp.com/send?text=Recreating%20the%20Rain%20Drop%20Effect%20in%20The%20Legend%20of%20Zelda%3a%20TOTK%20-%20https%3a%2f%2fsky-haihai.github.io%2fYaotian-Huang%2fposts%2fgamedev%2frecreating-the-rain-drop-effect-in-the-legend-of-zelda-totk%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-58.673,127.703c-33.842,-33.881 -78.847,-52.548 -126.798,-52.568c-98.799,0 -179.21,80.405 -179.249,179.234c-0.013,31.593 8.241,62.428 23.927,89.612l-25.429,92.884l95.021,-24.925c26.181,14.28 55.659,21.807 85.658,21.816l0.074,0c98.789,0 179.206,-80.413 179.247,-179.243c0.018,-47.895 -18.61,-92.93 -52.451,-126.81Zm-126.797,275.782l-0.06,0c-26.734,-0.01 -52.954,-7.193 -75.828,-20.767l-5.441,-3.229l-56.386,14.792l15.05,-54.977l-3.542,-5.637c-14.913,-23.72 -22.791,-51.136 -22.779,-79.287c0.033,-82.142 66.867,-148.971 149.046,-148.971c39.793,0.014 77.199,15.531 105.329,43.692c28.128,28.16 43.609,65.592 43.594,105.4c-0.034,82.149 -66.866,148.983 -148.983,148.984Zm81.721,-111.581c-4.479,-2.242 -26.499,-13.075 -30.604,-14.571c-4.105,-1.495 -7.091,-2.241 -10.077,2.241c-2.986,4.483 -11.569,14.572 -14.182,17.562c-2.612,2.988 -5.225,3.364 -9.703,1.12c-4.479,-2.241 -18.91,-6.97 -36.017,-22.23c-13.314,-11.876 -22.304,-26.542 -24.916,-31.026c-2.612,-4.484 -0.279,-6.908 1.963,-9.14c2.016,-2.007 4.48,-5.232 6.719,-7.847c2.24,-2.615 2.986,-4.484 4.479,-7.472c1.493,-2.99 0.747,-5.604 -0.374,-7.846c-1.119,-2.241 -10.077,-24.288 -13.809,-33.256c-3.635,-8.733 -7.327,-7.55 -10.077,-7.688c-2.609,-0.13 -5.598,-0.158 -8.583,-0.158c-2.986,0 -7.839,1.121 -11.944,5.604c-4.105,4.484 -15.675,15.32 -15.675,37.364c0,22.046 16.048,43.342 18.287,46.332c2.24,2.99 31.582,48.227 76.511,67.627c10.685,4.615 19.028,7.371 25.533,9.434c10.728,3.41 20.492,2.929 28.209,1.775c8.605,-1.285 26.499,-10.833 30.231,-21.295c3.732,-10.464 3.732,-19.431 2.612,-21.298c-1.119,-1.869 -4.105,-2.99 -8.583,-5.232Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Recreating the Rain Drop Effect in The Legend of Zelda: TOTK on telegram"
        href="https://telegram.me/share/url?text=Recreating%20the%20Rain%20Drop%20Effect%20in%20The%20Legend%20of%20Zelda%3a%20TOTK&amp;url=https%3a%2f%2fsky-haihai.github.io%2fYaotian-Huang%2fposts%2fgamedev%2frecreating-the-rain-drop-effect-in-the-legend-of-zelda-totk%2f">
        <svg version="1.1" xml:space="preserve" viewBox="2 2 28 28" height="30px" width="30px" fill="currentColor">
            <path
                d="M26.49,29.86H5.5a3.37,3.37,0,0,1-2.47-1,3.35,3.35,0,0,1-1-2.47V5.48A3.36,3.36,0,0,1,3,3,3.37,3.37,0,0,1,5.5,2h21A3.38,3.38,0,0,1,29,3a3.36,3.36,0,0,1,1,2.46V26.37a3.35,3.35,0,0,1-1,2.47A3.38,3.38,0,0,1,26.49,29.86Zm-5.38-6.71a.79.79,0,0,0,.85-.66L24.73,9.24a.55.55,0,0,0-.18-.46.62.62,0,0,0-.41-.17q-.08,0-16.53,6.11a.59.59,0,0,0-.41.59.57.57,0,0,0,.43.52l4,1.24,1.61,4.83a.62.62,0,0,0,.63.43.56.56,0,0,0,.4-.17L16.54,20l4.09,3A.9.9,0,0,0,21.11,23.15ZM13.8,20.71l-1.21-4q8.72-5.55,8.78-5.55c.15,0,.23,0,.23.16a.18.18,0,0,1,0,.06s-2.51,2.3-7.52,6.8Z" />
        </svg>
    </a>
</div>
  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2024 <a href="https://sky-haihai.github.io/Yaotian-Huang/">Yaotian Huang</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
