<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Notes on Learning Mozilla Hubs: Scene | Yaotian Huang</title>
<meta name="keywords" content="Metaverse, Mozilla Hubs, Blender, GLB, Opimazation, Scene">
<meta name="description" content="Introduction Mozilla Hubs is a open-source browser-based metaverse web application that supports XR. The first thing to keep in mind is that it&rsquo;s component-based like Unity. In the official build, Hubs supports various but very limited components such as model renderer, images renderer, videos renderer, audio field, etc. Although what creators could do in Hubs is very limited by the default build, I could imagine it&rsquo;s bright future for two reasons:">
<meta name="author" content="sky_haihai">
<link rel="canonical" href="https://sky-haihai.github.io/Yaotian-Huang/posts/webdev/notes-on-learning-mozilla-hubs-scene/">
<link crossorigin="anonymous" href="/Yaotian-Huang/assets/css/stylesheet.62aa25427797f8efd87301a5b69795dc50df2dbe79a5fba0648cc7bb8dbcd7c9.css" integrity="sha256-YqolQneX&#43;O/YcwGltpeV3FDfLb55pfugZIzHu42818k=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/Yaotian-Huang/assets/js/highlight.acb54fd32bbc1982428b8850317e45d076b95012730a5936667e6bc21777692a.js" integrity="sha256-rLVP0yu8GYJCi4hQMX5F0Ha5UBJzClk2Zn5rwhd3aSo="
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://sky-haihai.github.io/Yaotian-Huang/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://sky-haihai.github.io/Yaotian-Huang/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://sky-haihai.github.io/Yaotian-Huang/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://sky-haihai.github.io/Yaotian-Huang/apple-touch-icon.png">
<link rel="mask-icon" href="https://sky-haihai.github.io/Yaotian-Huang/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:title" content="Notes on Learning Mozilla Hubs: Scene" />
<meta property="og:description" content="Introduction Mozilla Hubs is a open-source browser-based metaverse web application that supports XR. The first thing to keep in mind is that it&rsquo;s component-based like Unity. In the official build, Hubs supports various but very limited components such as model renderer, images renderer, videos renderer, audio field, etc. Although what creators could do in Hubs is very limited by the default build, I could imagine it&rsquo;s bright future for two reasons:" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://sky-haihai.github.io/Yaotian-Huang/posts/webdev/notes-on-learning-mozilla-hubs-scene/" /><meta property="og:image" content="https://sky-haihai.github.io/Yaotian-Huang/papermod-cover.png"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-10-26T10:27:04-06:00" />
<meta property="article:modified_time" content="2023-10-26T10:27:04-06:00" />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://sky-haihai.github.io/Yaotian-Huang/papermod-cover.png"/>

<meta name="twitter:title" content="Notes on Learning Mozilla Hubs: Scene"/>
<meta name="twitter:description" content="Introduction Mozilla Hubs is a open-source browser-based metaverse web application that supports XR. The first thing to keep in mind is that it&rsquo;s component-based like Unity. In the official build, Hubs supports various but very limited components such as model renderer, images renderer, videos renderer, audio field, etc. Although what creators could do in Hubs is very limited by the default build, I could imagine it&rsquo;s bright future for two reasons:"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://sky-haihai.github.io/Yaotian-Huang/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Notes on Learning Mozilla Hubs: Scene",
      "item": "https://sky-haihai.github.io/Yaotian-Huang/posts/webdev/notes-on-learning-mozilla-hubs-scene/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Notes on Learning Mozilla Hubs: Scene",
  "name": "Notes on Learning Mozilla Hubs: Scene",
  "description": "Introduction Mozilla Hubs is a open-source browser-based metaverse web application that supports XR. The first thing to keep in mind is that it\u0026rsquo;s component-based like Unity. In the official build, Hubs supports various but very limited components such as model renderer, images renderer, videos renderer, audio field, etc. Although what creators could do in Hubs is very limited by the default build, I could imagine it\u0026rsquo;s bright future for two reasons:",
  "keywords": [
    "Metaverse", "Mozilla Hubs", "Blender", "GLB", "Opimazation", "Scene"
  ],
  "articleBody": "Introduction Mozilla Hubs is a open-source browser-based metaverse web application that supports XR. The first thing to keep in mind is that it’s component-based like Unity. In the official build, Hubs supports various but very limited components such as model renderer, images renderer, videos renderer, audio field, etc. Although what creators could do in Hubs is very limited by the default build, I could imagine it’s bright future for two reasons:\nIt’s open-source, meaning developers could add their own components into the engine. Though, I wish the official team could add scripting interface as a component like Unity does. The rooms(scenes) are browser-based, meaning it’s cross-platform and easy to access, which attracts more users. Demo Scene As always, a Demo is worth a thousand words.\nThis demo is tested on the following devices:\nDevice\rOS\rBrowser\rFramerate\rDesktop(3060Ti)\rWindows 11\rChrome V.118 (64bits)\rStable 144FPS (Synced with monitor refresh rate)\rLaptop (No Dedicated GPU)\rWindows 11\rChrome (64bits)\r50FPS - 60FPS(Disable Real-time Shadow)\rIphone 7 Plus\rIOS\rSafari\rStable 60FPS\rLimitations No support for custom shaders No support for mipmaps No support for LOD No support for texture filters Alpha blending is supported in published scenes but limited to 1 time(1-bit) in spoke editor The only external scene editor work an replacement of Spoke is Blender. Other mainstream DCC(Digital Content Creation) software like Maya, 3ds Max, Cinema 4D, etc. are not supported. Scene Editing Workflow There are two types of workflow for artists to create Hubs scenes(.spoke) using Blender.\nBlender-As-Main-Editor The first one is what I called Blender-As-Main-Editor workflow:\nInstall Hubs Blender export addon Create models, draw/import textures, and eventually finish the scene in Blender Add required Hubs components to objects using the Hubs addon Export the scene as a .glb file In short: Asset creation in Blender -\u003e Add Hubs components in Blender -\u003e Export as .glb -\u003e Import .glb into Spoke as a\nBlender-As-Asset-Creation-Tool The second one is what I called Blender-As-Asset-Creation-Tool workflow:\nNo need to install Hubs Blender export addon Create modular models/collection of models in Blender Export the model/models as .glb files Login to Spoke editor and upload the .glb files as “My Assets” Place the assets in the scene and add components to them individually. Comparison Similarity Both workflows require Blender to create assets Difference The Blender-As-Main-Editor workflow requires setting up every detail in Blender before exporting the scene into Spoke and after that there is no way to give any adjustment to the scene in Spoke editor, while the other workflow can give artists more flexibility to adjust the scene in Spoke editor, especiall when dealing with a complex scene and collaborating with other artists. Rendering Pipeline PBR Pipeline Mozilla Hubs only support one lighting model: PBR(Physical-Based-Rendering), usually involving a physically based BRDF(Bidirectional Reflectance Distribution Function) to achieve realistic lighting. The PBR workflow is very common in modern 3D rendering engines and is also the default workflow in Blender.\nTextures PBR pipeline requires a set of textures to work properly.\nAlbedo Map(Color Map) Normal Map Roughness Map Metallic Map Ambient Occlusion Map Emission Map Transparency Map … However, PBR is expensive and web-based PBR is not going to look great by itself, therefore the pipeline I’m going for is Lightmapping + Simplified PBR, meaning only the Albedo Map and the Normal Map are nesscessary, and the scene/objects will still look decent.\nOfficial Suggestted Performance Budget Poly Count Up to 50,000 Triangles\nMaterials Up to 25 Unique Materials Haven’t tested if similar materials with different input values are batched together, but I guess they are not. Textures 256MB of VRAM Each texture should be not larger than 2048x2048 Lights Mobile does not support dynamic lights at all In high end devices such as Desktop browsers, 3 dynamic lights is suggested File Size 16MB for the whole scene in general This really just depends on network condition, in other words, location of the server Opimization Lightmapping The biggest compact of the visual quality of scene with limited graphical computing power for low-end devices is for sure Lightmapping. Because Hubs Rooms run on a browser which only support basic PBR lightmodle, without lightmaps, the scene will look like a flat cartoon. If you are not familiar with lightmapping, here’s a quick comparison:\nWith Lightmapping\rWithout Lightmapping\rMix Actual 3D and Billboard Models Since the scene is limited to 50k triangles, it’s important to insert some 2-triangle Billboard models to replace some 3D models that are far away from the camera or not important component of the scene. For example, in a demo scene I made while learning Hubs, I modelled the main objects: pumpkin lamps as 3D models and used a bunch of Billboards to replace the trees which are less important visual components of the scene, and the scene still looks decent.\nUse Low Resolution Textures While texture resolution has a suggested value of no larger than 2K, it is still important to keep in mind that not every object in the scene need a 2K texture. Artists should decide the resolution of each texture based on the size and the significance of the object in the scene. For example, a 2K texture is not necessary for a small bat that is far away from the camera. In that case, a 256x256 texture is probably enough.\nReduce Transparent Materials Alpha blending is expensive. If transparency is required, it’s suggested to use alpha test(cutoff) instead of alpha blend.\nRoom Accessing No account required Assets(e.g. Images, Videos) is URL-based, which means assets are downloaded from the company’s file server when user enters the room, e.g. images User can upload their own assets upon permission, but they will be deleted when the room is closed Some properties of objects in the room are shared across all users. (e.g. pause state of the video player, etc.) Some properties are not shared, (e.g. volume of the video player, position of the player model, etc.) Some user behaviours can be enabled/disabled by the room owner, (e.g. user can/cannot switch first/third person camera, user can/cannot fly, etc.) Copy Right Although Mozilla Hubs is open-sourced, the assets created by artists usually can only be used under conditions. It is nesscessary to follow the guideline of licenses of all assets used in the scene if the scene is public or used commercially.\nReferences Mozilla. Blender Addon Components Manual. Hubs Documentation. https://hubs.mozilla.com/docs/creators-blender-components.html\nMozilla. Optimizing Scenes. Hubs Documentation.\nhttps://hubs.mozilla.com/docs/spoke-optimization.html\nValencia, P. (2022, December 21). Creating 2d sprite-based Retro Worlds. Creator Labs.\nhttps://hubs.mozilla.com/labs/creating-retro-worlds/\n",
  "wordCount" : "1075",
  "inLanguage": "en",
  "datePublished": "2023-10-26T10:27:04-06:00",
  "dateModified": "2023-10-26T10:27:04-06:00",
  "author":{
    "@type": "Person",
    "name": "sky_haihai"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://sky-haihai.github.io/Yaotian-Huang/posts/webdev/notes-on-learning-mozilla-hubs-scene/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Yaotian Huang",
    "logo": {
      "@type": "ImageObject",
      "url": "https://sky-haihai.github.io/Yaotian-Huang/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://sky-haihai.github.io/Yaotian-Huang/" accesskey="h" title="Yaotian Huang (Alt + H)">Yaotian Huang</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://sky-haihai.github.io/Yaotian-Huang/archives" title="Archive">
                    <span>Archive</span>
                </a>
            </li>
            <li>
                <a href="https://sky-haihai.github.io/Yaotian-Huang/search/" title="Search (Alt &#43; /)" accesskey=/>
                    <span>Search</span>
                </a>
            </li>
            <li>
                <a href="https://sky-haihai.github.io/Yaotian-Huang/tags/" title="Tags">
                    <span>Tags</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://sky-haihai.github.io/Yaotian-Huang/">Home</a>&nbsp;»&nbsp;<a href="https://sky-haihai.github.io/Yaotian-Huang/posts/">Posts</a></div>
    <h1 class="post-title">
      Notes on Learning Mozilla Hubs: Scene
    </h1>
    <div class="post-meta"><span title='2023-10-26 10:27:04 -0600 MDT'>October 26, 2023</span>&nbsp;·&nbsp;6 min&nbsp;·&nbsp;sky_haihai

</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#introduction" aria-label="Introduction">Introduction</a></li>
                <li>
                    <a href="#demo-scene" aria-label="Demo Scene">Demo Scene</a></li>
                <li>
                    <a href="#limitations" aria-label="Limitations">Limitations</a></li>
                <li>
                    <a href="#scene-editing-workflow" aria-label="Scene Editing Workflow">Scene Editing Workflow</a><ul>
                        
                <li>
                    <a href="#blender-as-main-editor" aria-label="Blender-As-Main-Editor">Blender-As-Main-Editor</a></li>
                <li>
                    <a href="#blender-as-asset-creation-tool" aria-label="Blender-As-Asset-Creation-Tool">Blender-As-Asset-Creation-Tool</a></li>
                <li>
                    <a href="#comparison" aria-label="Comparison">Comparison</a><ul>
                        
                <li>
                    <a href="#similarity" aria-label="Similarity">Similarity</a></li>
                <li>
                    <a href="#difference" aria-label="Difference">Difference</a></li></ul>
                </li></ul>
                </li>
                <li>
                    <a href="#rendering-pipeline" aria-label="Rendering Pipeline">Rendering Pipeline</a><ul>
                        
                <li>
                    <a href="#pbr-pipeline" aria-label="PBR Pipeline">PBR Pipeline</a></li>
                <li>
                    <a href="#textures" aria-label="Textures">Textures</a></li></ul>
                </li>
                <li>
                    <a href="#official-suggestted-performance-budget" aria-label="Official Suggestted Performance Budget">Official Suggestted Performance Budget</a><ul>
                        
                <li>
                    <a href="#poly-count" aria-label="Poly Count">Poly Count</a></li>
                <li>
                    <a href="#materials" aria-label="Materials">Materials</a></li>
                <li>
                    <a href="#textures-1" aria-label="Textures">Textures</a></li>
                <li>
                    <a href="#lights" aria-label="Lights">Lights</a></li>
                <li>
                    <a href="#file-size" aria-label="File Size">File Size</a></li></ul>
                </li>
                <li>
                    <a href="#opimization" aria-label="Opimization">Opimization</a><ul>
                        
                <li>
                    <a href="#lightmapping" aria-label="Lightmapping">Lightmapping</a></li>
                <li>
                    <a href="#mix-actual-3d-and-billboard-models" aria-label="Mix Actual 3D and Billboard Models">Mix Actual 3D and Billboard Models</a></li>
                <li>
                    <a href="#use-low-resolution-textures" aria-label="Use Low Resolution Textures">Use Low Resolution Textures</a></li>
                <li>
                    <a href="#reduce-transparent-materials" aria-label="Reduce Transparent Materials">Reduce Transparent Materials</a></li></ul>
                </li>
                <li>
                    <a href="#room-accessing" aria-label="Room Accessing">Room Accessing</a></li>
                <li>
                    <a href="#copy-right" aria-label="Copy Right">Copy Right</a></li>
                <li>
                    <a href="#references" aria-label="References">References</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h2 id="introduction">Introduction<a hidden class="anchor" aria-hidden="true" href="#introduction">#</a></h2>
<p>Mozilla Hubs is a open-source browser-based metaverse web application that supports XR. The first thing to keep in mind is that it&rsquo;s component-based like Unity. In the official build, Hubs supports various but very limited components such as model renderer, images renderer, videos renderer, audio field, etc. Although what creators could do in Hubs is very limited by the default build, I could imagine it&rsquo;s bright future for two reasons:</p>
<ol>
<li>It&rsquo;s open-source, meaning developers could add their own components into the engine. Though, I wish the official team could add scripting interface as a component like Unity does.</li>
<li>The rooms(scenes) are browser-based, meaning it&rsquo;s cross-platform and easy to access, which attracts more users.</li>
</ol>
<h2 id="demo-scene">Demo Scene<a hidden class="anchor" aria-hidden="true" href="#demo-scene">#</a></h2>
<p>As always, a <a href="https://0827133699.us1.myhubs.net/link/BwXmTSy">Demo</a> is worth a thousand words.</p>
<p>This demo is tested on the following devices:</p>
<table>
    <tr>
        <td>Device</td>
        <td>OS</td>
        <td>Browser</td>
        <td>Framerate</td>
   </tr>
    <tr>
        <td>Desktop(3060Ti)</td>
        <td>Windows 11</td>
        <td>Chrome V.118 (64bits)</td>
        <td>Stable 144FPS (Synced with monitor refresh rate)</td>
    </tr>
    <tr>
        <td>Laptop (No Dedicated GPU)</td>
        <td>Windows 11</td>
        <td>Chrome (64bits)</td>
        <td>50FPS - 60FPS(Disable Real-time Shadow)</td>
    </tr>
    <tr>
        <td>Iphone 7 Plus</td>
        <td>IOS</td>
        <td>Safari</td>
        <td>Stable 60FPS</td>
    </tr>
</table>
<h2 id="limitations">Limitations<a hidden class="anchor" aria-hidden="true" href="#limitations">#</a></h2>
<ol>
<li>No support for custom shaders</li>
<li>No support for mipmaps</li>
<li>No support for LOD</li>
<li>No support for texture filters</li>
<li>Alpha blending is supported in published scenes but limited to 1 time(1-bit) in spoke editor</li>
<li>The only external scene editor work an replacement of Spoke is Blender. Other mainstream DCC(Digital Content Creation) software like Maya, 3ds Max, Cinema 4D, etc. are not supported.</li>
</ol>
<h2 id="scene-editing-workflow">Scene Editing Workflow<a hidden class="anchor" aria-hidden="true" href="#scene-editing-workflow">#</a></h2>
<p>There are two types of workflow for artists to create Hubs scenes(.spoke) using Blender.</p>
<h3 id="blender-as-main-editor">Blender-As-Main-Editor<a hidden class="anchor" aria-hidden="true" href="#blender-as-main-editor">#</a></h3>
<p>The first one is what I called Blender-As-Main-Editor workflow:</p>
<ol>
<li>Install Hubs Blender export addon</li>
<li>Create models, draw/import textures, and eventually finish the scene in Blender</li>
<li>Add required Hubs components to objects using the Hubs addon</li>
<li>Export the scene as a .glb file</li>
</ol>
<p>In short: Asset creation in Blender -&gt; Add Hubs components in Blender -&gt; Export as .glb -&gt; Import .glb into Spoke as a</p>
<h3 id="blender-as-asset-creation-tool">Blender-As-Asset-Creation-Tool<a hidden class="anchor" aria-hidden="true" href="#blender-as-asset-creation-tool">#</a></h3>
<p>The second one is what I called Blender-As-Asset-Creation-Tool workflow:</p>
<ol>
<li>No need to install Hubs Blender export addon</li>
<li>Create modular models/collection of models in Blender</li>
<li>Export the model/models as .glb files</li>
<li>Login to Spoke editor and upload the .glb files as &ldquo;My Assets&rdquo;</li>
<li>Place the assets in the scene and add components to them individually.</li>
</ol>
<h3 id="comparison">Comparison<a hidden class="anchor" aria-hidden="true" href="#comparison">#</a></h3>
<h4 id="similarity">Similarity<a hidden class="anchor" aria-hidden="true" href="#similarity">#</a></h4>
<ol>
<li>Both workflows require Blender to create assets</li>
</ol>
<h4 id="difference">Difference<a hidden class="anchor" aria-hidden="true" href="#difference">#</a></h4>
<ol>
<li>The Blender-As-Main-Editor workflow requires setting up every detail in Blender before exporting the scene into Spoke and after that there is no way to give any adjustment to the scene in Spoke editor, while the other workflow can give artists more flexibility to adjust the scene in Spoke editor, especiall when dealing with a complex scene and collaborating with other artists.</li>
</ol>
<h2 id="rendering-pipeline">Rendering Pipeline<a hidden class="anchor" aria-hidden="true" href="#rendering-pipeline">#</a></h2>
<h3 id="pbr-pipeline">PBR Pipeline<a hidden class="anchor" aria-hidden="true" href="#pbr-pipeline">#</a></h3>
<p>Mozilla Hubs only support one lighting model: PBR(Physical-Based-Rendering), usually involving a physically based BRDF(Bidirectional Reflectance Distribution Function) to achieve realistic lighting. The PBR workflow is very common in modern 3D rendering engines and is also the default workflow in Blender.</p>
<h3 id="textures">Textures<a hidden class="anchor" aria-hidden="true" href="#textures">#</a></h3>
<p>PBR pipeline requires a set of textures to work properly.</p>
<ol>
<li>Albedo Map(Color Map)</li>
<li>Normal Map</li>
<li>Roughness Map</li>
<li>Metallic Map</li>
<li>Ambient Occlusion Map</li>
<li>Emission Map</li>
<li>Transparency Map
&hellip;</li>
</ol>
<p>However, PBR is expensive and web-based PBR is not going to look great by itself, therefore the pipeline I&rsquo;m going for is Lightmapping + Simplified PBR, meaning only the Albedo Map and the Normal Map are nesscessary, and the scene/objects will still look decent.</p>
<h2 id="official-suggestted-performance-budget">Official Suggestted Performance Budget<a hidden class="anchor" aria-hidden="true" href="#official-suggestted-performance-budget">#</a></h2>
<h3 id="poly-count">Poly Count<a hidden class="anchor" aria-hidden="true" href="#poly-count">#</a></h3>
<p>Up to 50,000 Triangles</p>
<h3 id="materials">Materials<a hidden class="anchor" aria-hidden="true" href="#materials">#</a></h3>
<ul>
<li>Up to 25 Unique Materials</li>
<li>Haven&rsquo;t tested if similar materials with different input values are batched together, but I guess they are not.</li>
</ul>
<h3 id="textures-1">Textures<a hidden class="anchor" aria-hidden="true" href="#textures-1">#</a></h3>
<ul>
<li>256MB of VRAM</li>
<li>Each texture should be not larger than 2048x2048</li>
</ul>
<h3 id="lights">Lights<a hidden class="anchor" aria-hidden="true" href="#lights">#</a></h3>
<ul>
<li>Mobile does not support dynamic lights at all</li>
<li>In high end devices such as Desktop browsers, 3 dynamic lights is suggested</li>
</ul>
<h3 id="file-size">File Size<a hidden class="anchor" aria-hidden="true" href="#file-size">#</a></h3>
<ul>
<li>16MB for the whole scene in general</li>
<li>This really just depends on network condition, in other words, location of the server</li>
</ul>
<h2 id="opimization">Opimization<a hidden class="anchor" aria-hidden="true" href="#opimization">#</a></h2>
<h3 id="lightmapping">Lightmapping<a hidden class="anchor" aria-hidden="true" href="#lightmapping">#</a></h3>
<p>The biggest compact of the visual quality of scene with limited graphical computing power for low-end devices is for sure Lightmapping. Because Hubs Rooms run on a browser which only support basic PBR lightmodle, without lightmaps, the scene will look like a flat cartoon. If you are not familiar with lightmapping, here&rsquo;s a quick comparison:</p>
<p><figure>
    <img loading="lazy" src="with-lightmapping.png"/> <figcaption>
            With Lightmapping
        </figcaption>
</figure>

<figure>
    <img loading="lazy" src="without-lightmapping.png"/> <figcaption>
            Without Lightmapping
        </figcaption>
</figure>
</p>
<h3 id="mix-actual-3d-and-billboard-models">Mix Actual 3D and Billboard Models<a hidden class="anchor" aria-hidden="true" href="#mix-actual-3d-and-billboard-models">#</a></h3>
<p>Since the scene is limited to 50k triangles, it&rsquo;s important to insert some 2-triangle Billboard models to replace some 3D models that are far away from the camera or not important component of the scene. For example, in a demo scene I made while learning Hubs, I modelled the main objects: pumpkin lamps as 3D models and used a bunch of Billboards to replace the trees which are less important visual components of the scene, and the scene still looks decent.</p>
<figure>
    <img loading="lazy" src="billboard-tree.png"/> 
</figure>

<h3 id="use-low-resolution-textures">Use Low Resolution Textures<a hidden class="anchor" aria-hidden="true" href="#use-low-resolution-textures">#</a></h3>
<p>While texture resolution has a suggested value of no larger than 2K, it is still important to keep in mind that not every object in the scene need a 2K texture. Artists should decide the resolution of each texture based on the size and the significance of the object in the scene. For example, a 2K texture is not necessary for a small bat that is far away from the camera. In that case, a 256x256 texture is probably enough.</p>
<h3 id="reduce-transparent-materials">Reduce Transparent Materials<a hidden class="anchor" aria-hidden="true" href="#reduce-transparent-materials">#</a></h3>
<p>Alpha blending is expensive. If transparency is required, it&rsquo;s suggested to use alpha test(cutoff) instead of alpha blend.</p>
<h2 id="room-accessing">Room Accessing<a hidden class="anchor" aria-hidden="true" href="#room-accessing">#</a></h2>
<ul>
<li>No account required</li>
<li>Assets(e.g. Images, Videos) is URL-based, which means assets are downloaded from the company&rsquo;s file server when user enters the room, e.g. images</li>
<li>User can upload their own assets upon permission, but they will be deleted when the room is closed</li>
<li>Some properties of objects in the room are shared across all users. (e.g. pause state of the video player, etc.)</li>
<li>Some properties are not shared, (e.g. volume of the video player, position of the player model, etc.)</li>
<li>Some user behaviours can be enabled/disabled by the room owner, (e.g. user can/cannot switch first/third person camera, user can/cannot fly, etc.)</li>
</ul>
<h2 id="copy-right">Copy Right<a hidden class="anchor" aria-hidden="true" href="#copy-right">#</a></h2>
<p>Although Mozilla Hubs is open-sourced, the assets created by artists usually can only be used under conditions. It is nesscessary to follow the guideline of licenses of all assets used in the scene if the scene is public or used commercially.</p>
<h2 id="references">References<a hidden class="anchor" aria-hidden="true" href="#references">#</a></h2>
<p>Mozilla. Blender Addon Components Manual. Hubs Documentation. <a href="https://hubs.mozilla.com/docs/creators-blender-components.html">https://hubs.mozilla.com/docs/creators-blender-components.html</a></p>
<p>Mozilla. Optimizing Scenes. Hubs Documentation.<br>
<a href="https://hubs.mozilla.com/docs/spoke-optimization.html">https://hubs.mozilla.com/docs/spoke-optimization.html</a></p>
<p>Valencia, P. (2022, December 21). Creating 2d sprite-based Retro Worlds. Creator Labs.<br>
<a href="https://hubs.mozilla.com/labs/creating-retro-worlds/">https://hubs.mozilla.com/labs/creating-retro-worlds/</a></p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://sky-haihai.github.io/Yaotian-Huang/tags/metaverse/">Metaverse</a></li>
      <li><a href="https://sky-haihai.github.io/Yaotian-Huang/tags/mozilla-hubs/">Mozilla Hubs</a></li>
      <li><a href="https://sky-haihai.github.io/Yaotian-Huang/tags/blender/">Blender</a></li>
      <li><a href="https://sky-haihai.github.io/Yaotian-Huang/tags/glb/">GLB</a></li>
      <li><a href="https://sky-haihai.github.io/Yaotian-Huang/tags/opimazation/">Opimazation</a></li>
      <li><a href="https://sky-haihai.github.io/Yaotian-Huang/tags/scene/">Scene</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="https://sky-haihai.github.io/Yaotian-Huang/posts/webdev/notes-on-learning-mozilla-hubs-avator/">
    <span class="title">« Prev</span>
    <br>
    <span>Notes on Learning Mozilla Hubs: Avator</span>
  </a>
  <a class="next" href="https://sky-haihai.github.io/Yaotian-Huang/posts/gamedev/harmony-script-adding-placeholder-drawings-to-empty-timeline-cells/">
    <span class="title">Next »</span>
    <br>
    <span>Harmony Script: Adding Placeholder Drawings to Empty Timeline Cells</span>
  </a>
</nav>


<div class="share-buttons">
    <a target="_blank" rel="noopener noreferrer" aria-label="share Notes on Learning Mozilla Hubs: Scene on twitter"
        href="https://twitter.com/intent/tweet/?text=Notes%20on%20Learning%20Mozilla%20Hubs%3a%20Scene&amp;url=https%3a%2f%2fsky-haihai.github.io%2fYaotian-Huang%2fposts%2fwebdev%2fnotes-on-learning-mozilla-hubs-scene%2f&amp;hashtags=Metaverse%2cMozillaHubs%2cBlender%2cGLB%2cOpimazation%2cScene">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-253.927,424.544c135.939,0 210.268,-112.643 210.268,-210.268c0,-3.218 0,-6.437 -0.153,-9.502c14.406,-10.421 26.973,-23.448 36.935,-38.314c-13.18,5.824 -27.433,9.809 -42.452,11.648c15.326,-9.196 26.973,-23.602 32.49,-40.92c-14.252,8.429 -30.038,14.56 -46.896,17.931c-13.487,-14.406 -32.644,-23.295 -53.946,-23.295c-40.767,0 -73.87,33.104 -73.87,73.87c0,5.824 0.613,11.494 1.992,16.858c-61.456,-3.065 -115.862,-32.49 -152.337,-77.241c-6.284,10.881 -9.962,23.601 -9.962,37.088c0,25.594 13.027,48.276 32.95,61.456c-12.107,-0.307 -23.448,-3.678 -33.41,-9.196l0,0.92c0,35.862 25.441,65.594 59.311,72.49c-6.13,1.686 -12.72,2.606 -19.464,2.606c-4.751,0 -9.348,-0.46 -13.946,-1.38c9.349,29.426 36.628,50.728 68.965,51.341c-25.287,19.771 -57.164,31.571 -91.8,31.571c-5.977,0 -11.801,-0.306 -17.625,-1.073c32.337,21.15 71.264,33.41 112.95,33.41Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Notes on Learning Mozilla Hubs: Scene on linkedin"
        href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fsky-haihai.github.io%2fYaotian-Huang%2fposts%2fwebdev%2fnotes-on-learning-mozilla-hubs-scene%2f&amp;title=Notes%20on%20Learning%20Mozilla%20Hubs%3a%20Scene&amp;summary=Notes%20on%20Learning%20Mozilla%20Hubs%3a%20Scene&amp;source=https%3a%2f%2fsky-haihai.github.io%2fYaotian-Huang%2fposts%2fwebdev%2fnotes-on-learning-mozilla-hubs-scene%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Notes on Learning Mozilla Hubs: Scene on reddit"
        href="https://reddit.com/submit?url=https%3a%2f%2fsky-haihai.github.io%2fYaotian-Huang%2fposts%2fwebdev%2fnotes-on-learning-mozilla-hubs-scene%2f&title=Notes%20on%20Learning%20Mozilla%20Hubs%3a%20Scene">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-3.446,265.638c0,-22.964 -18.616,-41.58 -41.58,-41.58c-11.211,0 -21.361,4.457 -28.841,11.666c-28.424,-20.508 -67.586,-33.757 -111.204,-35.278l18.941,-89.121l61.884,13.157c0.756,15.734 13.642,28.29 29.56,28.29c16.407,0 29.706,-13.299 29.706,-29.701c0,-16.403 -13.299,-29.702 -29.706,-29.702c-11.666,0 -21.657,6.792 -26.515,16.578l-69.105,-14.69c-1.922,-0.418 -3.939,-0.042 -5.585,1.036c-1.658,1.073 -2.811,2.761 -3.224,4.686l-21.152,99.438c-44.258,1.228 -84.046,14.494 -112.837,35.232c-7.468,-7.164 -17.589,-11.591 -28.757,-11.591c-22.965,0 -41.585,18.616 -41.585,41.58c0,16.896 10.095,31.41 24.568,37.918c-0.639,4.135 -0.99,8.328 -0.99,12.576c0,63.977 74.469,115.836 166.33,115.836c91.861,0 166.334,-51.859 166.334,-115.836c0,-4.218 -0.347,-8.387 -0.977,-12.493c14.564,-6.47 24.735,-21.034 24.735,-38.001Zm-119.474,108.193c-20.27,20.241 -59.115,21.816 -70.534,21.816c-11.428,0 -50.277,-1.575 -70.522,-21.82c-3.007,-3.008 -3.007,-7.882 0,-10.889c3.003,-2.999 7.882,-3.003 10.885,0c12.777,12.781 40.11,17.317 59.637,17.317c19.522,0 46.86,-4.536 59.657,-17.321c3.016,-2.999 7.886,-2.995 10.885,0.008c3.008,3.011 3.003,7.882 -0.008,10.889Zm-5.23,-48.781c-16.373,0 -29.701,-13.324 -29.701,-29.698c0,-16.381 13.328,-29.714 29.701,-29.714c16.378,0 29.706,13.333 29.706,29.714c0,16.374 -13.328,29.698 -29.706,29.698Zm-160.386,-29.702c0,-16.381 13.328,-29.71 29.714,-29.71c16.369,0 29.689,13.329 29.689,29.71c0,16.373 -13.32,29.693 -29.689,29.693c-16.386,0 -29.714,-13.32 -29.714,-29.693Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Notes on Learning Mozilla Hubs: Scene on facebook"
        href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fsky-haihai.github.io%2fYaotian-Huang%2fposts%2fwebdev%2fnotes-on-learning-mozilla-hubs-scene%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-106.468,0l0,-192.915l66.6,0l12.672,-82.621l-79.272,0l0,-53.617c0,-22.603 11.073,-44.636 46.58,-44.636l36.042,0l0,-70.34c0,0 -32.71,-5.582 -63.982,-5.582c-65.288,0 -107.96,39.569 -107.96,111.204l0,62.971l-72.573,0l0,82.621l72.573,0l0,192.915l-191.104,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Notes on Learning Mozilla Hubs: Scene on whatsapp"
        href="https://api.whatsapp.com/send?text=Notes%20on%20Learning%20Mozilla%20Hubs%3a%20Scene%20-%20https%3a%2f%2fsky-haihai.github.io%2fYaotian-Huang%2fposts%2fwebdev%2fnotes-on-learning-mozilla-hubs-scene%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-58.673,127.703c-33.842,-33.881 -78.847,-52.548 -126.798,-52.568c-98.799,0 -179.21,80.405 -179.249,179.234c-0.013,31.593 8.241,62.428 23.927,89.612l-25.429,92.884l95.021,-24.925c26.181,14.28 55.659,21.807 85.658,21.816l0.074,0c98.789,0 179.206,-80.413 179.247,-179.243c0.018,-47.895 -18.61,-92.93 -52.451,-126.81Zm-126.797,275.782l-0.06,0c-26.734,-0.01 -52.954,-7.193 -75.828,-20.767l-5.441,-3.229l-56.386,14.792l15.05,-54.977l-3.542,-5.637c-14.913,-23.72 -22.791,-51.136 -22.779,-79.287c0.033,-82.142 66.867,-148.971 149.046,-148.971c39.793,0.014 77.199,15.531 105.329,43.692c28.128,28.16 43.609,65.592 43.594,105.4c-0.034,82.149 -66.866,148.983 -148.983,148.984Zm81.721,-111.581c-4.479,-2.242 -26.499,-13.075 -30.604,-14.571c-4.105,-1.495 -7.091,-2.241 -10.077,2.241c-2.986,4.483 -11.569,14.572 -14.182,17.562c-2.612,2.988 -5.225,3.364 -9.703,1.12c-4.479,-2.241 -18.91,-6.97 -36.017,-22.23c-13.314,-11.876 -22.304,-26.542 -24.916,-31.026c-2.612,-4.484 -0.279,-6.908 1.963,-9.14c2.016,-2.007 4.48,-5.232 6.719,-7.847c2.24,-2.615 2.986,-4.484 4.479,-7.472c1.493,-2.99 0.747,-5.604 -0.374,-7.846c-1.119,-2.241 -10.077,-24.288 -13.809,-33.256c-3.635,-8.733 -7.327,-7.55 -10.077,-7.688c-2.609,-0.13 -5.598,-0.158 -8.583,-0.158c-2.986,0 -7.839,1.121 -11.944,5.604c-4.105,4.484 -15.675,15.32 -15.675,37.364c0,22.046 16.048,43.342 18.287,46.332c2.24,2.99 31.582,48.227 76.511,67.627c10.685,4.615 19.028,7.371 25.533,9.434c10.728,3.41 20.492,2.929 28.209,1.775c8.605,-1.285 26.499,-10.833 30.231,-21.295c3.732,-10.464 3.732,-19.431 2.612,-21.298c-1.119,-1.869 -4.105,-2.99 -8.583,-5.232Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Notes on Learning Mozilla Hubs: Scene on telegram"
        href="https://telegram.me/share/url?text=Notes%20on%20Learning%20Mozilla%20Hubs%3a%20Scene&amp;url=https%3a%2f%2fsky-haihai.github.io%2fYaotian-Huang%2fposts%2fwebdev%2fnotes-on-learning-mozilla-hubs-scene%2f">
        <svg version="1.1" xml:space="preserve" viewBox="2 2 28 28" height="30px" width="30px" fill="currentColor">
            <path
                d="M26.49,29.86H5.5a3.37,3.37,0,0,1-2.47-1,3.35,3.35,0,0,1-1-2.47V5.48A3.36,3.36,0,0,1,3,3,3.37,3.37,0,0,1,5.5,2h21A3.38,3.38,0,0,1,29,3a3.36,3.36,0,0,1,1,2.46V26.37a3.35,3.35,0,0,1-1,2.47A3.38,3.38,0,0,1,26.49,29.86Zm-5.38-6.71a.79.79,0,0,0,.85-.66L24.73,9.24a.55.55,0,0,0-.18-.46.62.62,0,0,0-.41-.17q-.08,0-16.53,6.11a.59.59,0,0,0-.41.59.57.57,0,0,0,.43.52l4,1.24,1.61,4.83a.62.62,0,0,0,.63.43.56.56,0,0,0,.4-.17L16.54,20l4.09,3A.9.9,0,0,0,21.11,23.15ZM13.8,20.71l-1.21-4q8.72-5.55,8.78-5.55c.15,0,.23,0,.23.16a.18.18,0,0,1,0,.06s-2.51,2.3-7.52,6.8Z" />
        </svg>
    </a>
</div>
  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2023 <a href="https://sky-haihai.github.io/Yaotian-Huang/">Yaotian Huang</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
